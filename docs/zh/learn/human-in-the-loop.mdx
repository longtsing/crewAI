---
title: "人工循环 (HITL) 工作流程"
description: "学习如何在 CrewAI 中实现人工循环工作流程以增强决策制定"
icon: "user-check"
mode: "wide"
---

人工循环 (HITL) 是一种强大的方法，结合人工智能与人类专业知识以增强决策制定并改善任务结果。本指南向您展示如何在 CrewAI 中实现 HITL。

## 设置 HITL 工作流程

<Steps>
    <Step title="配置您的任务">
        设置启用人工输入的任务：
        <Frame>
            <img src="/images/enterprise/crew-human-input.png" alt="团队人工输入" />
        </Frame>
    </Step>

    <Step title="提供 Webhook URL">
        当启动您的团队时，包含一个用于人工输入的 webhook URL：
        <Frame>
            <img src="/images/enterprise/crew-webhook-url.png" alt="团队 Webhook URL" />
        </Frame>

        使用 Bearer 认证的示例：
        ```bash
        curl -X POST {BASE_URL}/kickoff \
          -H "Authorization: Bearer YOUR_API_TOKEN" \
          -H "Content-Type: application/json" \
          -d '{
            "inputs": {
              "topic": "AI Research"
            },
            "humanInputWebhook": {
              "url": "https://your-webhook.com/hitl",
              "authentication": {
                "strategy": "bearer",
                "token": "your-webhook-secret-token"
              }
            }
          }'
        ```

        或使用基本认证：
        ```bash
        curl -X POST {BASE_URL}/kickoff \
          -H "Authorization: Bearer YOUR_API_TOKEN" \
          -H "Content-Type: application/json" \
          -d '{
            "inputs": {
              "topic": "AI Research"
            },
            "humanInputWebhook": {
              "url": "https://your-webhook.com/hitl",
              "authentication": {
                "strategy": "basic",
                "username": "your-username",
                "password": "your-password"
              }
            }
          }'
        ```
    </Step>

    <Step title="接收 Webhook 通知">
        一旦团队完成需要人工输入的任务，您将收到包含以下内容的 webhook 通知：
            - 执行 ID
            - 任务 ID
            - 任务输出
    </Step>

    <Step title="审查任务输出">
        系统将在"等待人工输入"状态下暂停。仔细审查任务输出。
    </Step>

    <Step title="提交人工反馈">
        使用以下信息调用您的团队的恢复端点：
        <Frame>
            <img src="/images/enterprise/crew-resume-endpoint.png" alt="团队恢复端点" />
        </Frame>

        <Warning>
            **关键：必须再次提供 Webhook URL**：
            您**必须**在恢复调用中提供与启动调用中使用的相同 webhook URL（`taskWebhookUrl`、`stepWebhookUrl`、`crewWebhookUrl`）。Webhook 配置**不会**从启动自动传递 - 它们必须在恢复请求中明确包含，以继续接收任务完成、代理步骤和团队完成的通知。
        </Warning>

        带有 webhook 的恢复调用示例：
        ```bash
        curl -X POST {BASE_URL}/resume \
          -H "Authorization: Bearer YOUR_API_TOKEN" \
          -H "Content-Type: application/json" \
          -d '{
            "execution_id": "abcd1234-5678-90ef-ghij-klmnopqrstuv",
            "task_id": "research_task",
            "human_feedback": "很棒的工作！请添加更多细节。",
            "is_approve": true,
            "taskWebhookUrl": "https://your-server.com/webhooks/task",
            "stepWebhookUrl": "https://your-server.com/webhooks/step",
            "crewWebhookUrl": "https://your-server.com/webhooks/crew"
          }'
        ```

        <Warning>
            **反馈对任务执行的影响**：
            提供反馈时务必谨慎，因为整个反馈内容将作为进一步任务执行的附加上下文被包含。
        </Warning>
        这意味着：
        - 反馈中的所有信息都成为任务上下文的一部分。
        - 不相关的细节可能会对它产生负面影响。
        - 简洁、相关的反馈有助于保持任务焦点和效率。
        - 在提交前始终仔细审查您的反馈，确保它只包含对指导任务执行有积极影响的恰当信息。
    </Step>
    <Step title="处理负面反馈">
        如果您提供负面反馈：
        - 团队将使用您的反馈中的附加上下文重试任务。
        - 您将收到另一个 webhook 通知以供进一步审查。
        - 重复步骤 4-6 直到满意。
    </Step>

    <Step title="执行继续">
        当您提交正面反馈时，执行将继续进行到下一步。
    </Step>
</Steps>

## 最佳实践

- **具体明确**：提供清晰、可操作的反馈，直接解决手头的任务
- **保持相关性**：只包含有助于改善任务执行的信息
- **及时响应**：及时响应 HITL 提示以避免工作流程延迟
- **仔细审查**：在提交前仔细检查您的反馈以确保准确性

## 常见用例

HITL 工作流程特别适用于：
- 质量保证和验证
- 复杂决策场景
- 敏感或高风险操作
- 需要人类判断的创意任务
- 合规性和监管审查