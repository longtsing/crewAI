---
title: è®°å¿†
description: åˆ©ç”¨ CrewAI æ¡†æ¶ä¸­çš„è®°å¿†ç³»ç»Ÿæ¥å¢å¼ºä»£ç†èƒ½åŠ›ã€‚
icon: database
mode: "wide"
---

## æ¦‚è¿°

CrewAI æ¡†æ¶æä¾›äº†ä¸€ä¸ªå¤æ‚çš„è®°å¿†ç³»ç»Ÿï¼Œæ—¨åœ¨æ˜¾è‘—å¢å¼º AI ä»£ç†èƒ½åŠ›ã€‚CrewAI æä¾›**ä¸¤ç§ä¸åŒçš„è®°å¿†æ–¹æ³•**ï¼ŒæœåŠ¡äºä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼š

1. **åŸºç¡€è®°å¿†ç³»ç»Ÿ** - å†…ç½®çš„çŸ­æœŸã€é•¿æœŸå’Œå®ä½“è®°å¿†
2. **å¤–éƒ¨è®°å¿†** - ç‹¬ç«‹çš„å¤–éƒ¨è®°å¿†æä¾›ç¨‹åº

## è®°å¿†ç³»ç»Ÿç»„ä»¶

| ç»„ä»¶            | æè¿°                                                                                                             |
| :------------------- | :---------------------------------------------------------------------------------------------------------------------- |
| **çŸ­æœŸè®°å¿†**| ä½¿ç”¨ `RAG` æš‚æ—¶å­˜å‚¨æœ€è¿‘çš„äº¤äº’å’Œç»“æœï¼Œä½¿ä»£ç†èƒ½å¤Ÿåœ¨å½“å‰æ‰§è¡ŒæœŸé—´å›å¿†å’Œåˆ©ç”¨ä¸å…¶å½“å‰ä¸Šä¸‹æ–‡ç›¸å…³çš„ä¿¡æ¯ã€‚|
| **é•¿æœŸè®°å¿†** | ä¿å­˜è¿‡å»æ‰§è¡Œä¸­æœ‰ä»·å€¼çš„è§è§£å’Œå­¦ä¹ ï¼Œä½¿ä»£ç†èƒ½å¤Ÿéšæ—¶é—´æ„å»ºå’Œå®Œå–„å…¶çŸ¥è¯†ã€‚ |
| **å®ä½“è®°å¿†**    | æ•è·å’Œç»„ç»‡åœ¨ä»»åŠ¡æœŸé—´é‡åˆ°çš„å®ä½“ï¼ˆäººå‘˜ã€åœ°ç‚¹ã€æ¦‚å¿µï¼‰ä¿¡æ¯ï¼Œä¿ƒè¿›æ›´æ·±å…¥çš„ç†è§£å’Œå…³ç³»æ˜ å°„ã€‚ä½¿ç”¨ `RAG` å­˜å‚¨å®ä½“ä¿¡æ¯ã€‚ |
| **ä¸Šä¸‹æ–‡è®°å¿†**| é€šè¿‡ç»“åˆ `ShortTermMemory`ã€`LongTermMemory`ã€`ExternalMemory` å’Œ `EntityMemory` æ¥ç»´æŠ¤äº¤äº’çš„ä¸Šä¸‹æ–‡ï¼Œå¸®åŠ©ä»£ç†åœ¨ä¸€ç³»åˆ—ä»»åŠ¡æˆ–å¯¹è¯ä¸­ä¿æŒå“åº”çš„è¿è´¯æ€§å’Œç›¸å…³æ€§ã€‚ |

## 1. åŸºç¡€è®°å¿†ç³»ç»Ÿï¼ˆæ¨èï¼‰

æœ€ç®€å•å’Œæœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚ä½¿ç”¨å•ä¸ªå‚æ•°ä¸ºæ‚¨çš„å›¢é˜Ÿå¯ç”¨è®°å¿†ï¼š

### å¿«é€Ÿå¼€å§‹
```python
from crewai import Crew, Agent, Task, Process

# å¯ç”¨åŸºç¡€è®°å¿†ç³»ç»Ÿ
crew = Crew(
    agents=[...],
    tasks=[...],
    process=Process.sequential,
    memory=True,  # å¯ç”¨çŸ­æœŸã€é•¿æœŸå’Œå®ä½“è®°å¿†
    verbose=True
)
```

### å·¥ä½œåŸç†
- **çŸ­æœŸè®°å¿†**ï¼šä½¿ç”¨ ChromaDB å’Œ RAG è¿›è¡Œå½“å‰ä¸Šä¸‹æ–‡
- **é•¿æœŸè®°å¿†**ï¼šä½¿ç”¨ SQLite3 åœ¨ä¼šè¯é—´å­˜å‚¨ä»»åŠ¡ç»“æœ
- **å®ä½“è®°å¿†**ï¼šä½¿ç”¨ RAG è·Ÿè¸ªå®ä½“ï¼ˆäººå‘˜ã€åœ°ç‚¹ã€æ¦‚å¿µï¼‰
- **å­˜å‚¨ä½ç½®**ï¼šé€šè¿‡ `appdirs` åŒ…åŒ…çš„å¹³å°ç‰¹å®šä½ç½®
- **è‡ªå®šä¹‰å­˜å‚¨ç›®å½•**ï¼šè®¾ç½® `CREWAI_STORAGE_DIR` ç¯å¢ƒå˜é‡

## å­˜å‚¨ä½ç½®é€æ˜åº¦

<Info>
**ç†è§£å­˜å‚¨ä½ç½®**ï¼šCrewAI ä½¿ç”¨å¹³å°ç‰¹å®šç›®å½•æ¥å­˜å‚¨è®°å¿†å’ŒçŸ¥è¯†æ–‡ä»¶ï¼Œéµå¾ªæ“ä½œç³»ç»Ÿçº¦å®šã€‚ç†è§£è¿™äº›ä½ç½®æœ‰åŠ©äºç”Ÿäº§éƒ¨ç½²ã€å¤‡ä»½å’Œè°ƒè¯•ã€‚
</Info>

### CrewAI å­˜å‚¨æ–‡ä»¶çš„ä½ç½®

é»˜è®¤æƒ…å†µä¸‹ï¼ŒCrewAI ä½¿ç”¨ `appdirs` åº“æ¥ç¡®å®šéµå¾ªå¹³å°çº¦å®šçš„å­˜å‚¨ä½ç½®ã€‚ä»¥ä¸‹æ˜¯åœ¨ç³»ç»Ÿä¸Šå­˜å‚¨æ–‡ä»¶çš„ç¡®åˆ‡ä½ç½®ï¼š

#### é»˜è®¤å„å¹³å°å­˜å‚¨ä½ç½®

**macOSï¼š**
```
~/Library/Application Support/CrewAI/{project_name}/
â”œâ”€â”€ knowledge/           # çŸ¥è¯†åº“ ChromaDB æ–‡ä»¶
â”œâ”€â”€ short_term_memory/   # çŸ­æœŸè®°å¿† ChromaDB æ–‡ä»¶
â”œâ”€â”€ long_term_memory/    # é•¿æœŸè®°å¿† ChromaDB æ–‡ä»¶
â”œâ”€â”€ entities/            # å®ä½“è®°å¿† ChromaDB æ–‡ä»¶
â””â”€â”€ long_term_memory_storage.db  # SQLite æ•°æ®åº“
```

**Linuxï¼š**
```
~/.local/share/CrewAI/{project_name}/
â”œâ”€â”€ knowledge/
â”œâ”€â”€ short_term_memory/
â”œâ”€â”€ long_term_memory/
â”œâ”€â”€ entities/
â””â”€â”€ long_term_memory_storage.db
```

**Windowsï¼š**
```
C:\Users\{username}\AppData\Local\CrewAI\{project_name}\
â”œâ”€â”€ knowledge\
â”œâ”€â”€ short_term_memory\
â”œâ”€â”€ long_term_memory\
â”œâ”€â”€ entities\
â””â”€â”€ long_term_memory_storage.db
```

### æŸ¥æ‰¾æ‚¨çš„å­˜å‚¨ä½ç½®

è¦æŸ¥çœ‹ CrewAI åœ¨ç³»ç»Ÿä¸Šå­˜å‚¨æ–‡ä»¶çš„ç¡®åˆ‡ä½ç½®ï¼š

```python
from crewai.utilities.paths import db_storage_path
import os

# è·å–åŸºç¡€å­˜å‚¨è·¯å¾„
storage_path = db_storage_path()
print(f"CrewAI storage location: {storage_path}")

# åˆ—å‡ºæ‰€æœ‰ CrewAI å­˜å‚¨ç›®å½•
if os.path.exists(storage_path):
    print("\nå­˜å‚¨çš„æ–‡ä»¶å’Œç›®å½•ï¼š")
    for item in os.listdir(storage_path):
        item_path = os.path.join(storage_path, item)
        if os.path.isdir(item_path):
            print(f"ğŸ“ {item}/")
            # æ˜¾ç¤º ChromaDB é›†åˆ
            if os.path.exists(item_path):
                for subitem in os.listdir(item_path):
                    print(f"   â””â”€â”€ {subitem}")
        else:
            print(f"ğŸ“„ {item}")
else:
    print("å°šæœªæ‰¾åˆ° CrewAI å­˜å‚¨ç›®å½•ã€‚")
```

### æ§åˆ¶å­˜å‚¨ä½ç½®

#### é€‰é¡¹ 1ï¼šç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰
```python
import os
from crewai import Crew

# è®¾ç½®è‡ªå®šä¹‰å­˜å‚¨ä½ç½®
os.environ["CREWAI_STORAGE_DIR"] = "./my_project_storage"

# ç°åœ¨æ‰€æœ‰è®°å¿†å’ŒçŸ¥è¯†å°†å­˜å‚¨åœ¨ ./my_project_storage/ ä¸­
crew = Crew(
    agents=[...],
    tasks=[...],
    memory=True
)
```

#### é€‰é¡¹ 2ï¼šè‡ªå®šä¹‰å­˜å‚¨è·¯å¾„
```python
import os
from crewai import Crew
from crewai.memory import LongTermMemory
from crewai.memory.storage.ltm_sqlite_storage import LTMSQLiteStorage

# é…ç½®è‡ªå®šä¹‰å­˜å‚¨ä½ç½®
custom_storage_path = "./storage"
os.makedirs(custom_storage_path, exist_ok=True)

crew = Crew(
    memory=True,
    long_term_memory=LongTermMemory(
        storage=LTMSQLiteStorage(
            db_path=f"{custom_storage_path}/memory.db"
        )
    )
)
```

#### é€‰é¡¹ 3ï¼šé¡¹ç›®ç‰¹å®šå­˜å‚¨
```python
import os
from pathlib import Path

# å­˜å‚¨åœ¨é¡¹ç›®ç›®å½•ä¸­
project_root = Path(__file__).parent
storage_dir = project_root / "crewai_storage"

os.environ["CREWAI_STORAGE_DIR"] = str(storage_dir)

# ç°åœ¨æ‰€æœ‰å­˜å‚¨å°†ä½äºæ‚¨çš„é¡¹ç›®ç›®å½•ä¸­
```

### åµŒå…¥æä¾›å•†é»˜è®¤è®¾ç½®

<Info>
**é»˜è®¤åµŒå…¥æä¾›å•†**ï¼šCrewAI é»˜è®¤ä½¿ç”¨ OpenAI åµŒå…¥ä»¥ä¿æŒä¸€è‡´æ€§å’Œå¯é æ€§ã€‚æ‚¨å¯ä»¥è½»æ¾è‡ªå®šä¹‰æ­¤è®¾ç½®ä»¥åŒ¹é…æ‚¨çš„ LLM æä¾›å•†æˆ–ä½¿ç”¨æœ¬åœ°åµŒå…¥ã€‚
</Info>

#### ç†è§£é»˜è®¤è¡Œä¸º
```python
# å½“ä½¿ç”¨ Claude ä½œä¸ºæ‚¨çš„ LLM æ—¶...
from crewai import Agent, LLM

agent = Agent(
    role="åˆ†æå¸ˆ",
    goal="åˆ†ææ•°æ®",
    backstory="ä¸“å®¶åˆ†æå¸ˆ",
    llm=LLM(provider="anthropic", model="claude-3-sonnet")  # ä½¿ç”¨ Claude
)

# CrewAI é»˜è®¤å°†ä½¿ç”¨ OpenAI åµŒå…¥ä»¥ä¿æŒä¸€è‡´
# æ‚¨å¯ä»¥è½»æ¾è‡ªå®šä¹‰æ­¤è®¾ç½®ä»¥åŒ¹é…æ‚¨åå¥½çš„æä¾›å•†
```

#### è‡ªå®šä¹‰åµŒ å…¥æä¾›å•†
```python
from crewai import Crew

# é€‰é¡¹ 1ï¼šåŒ¹é…æ‚¨çš„ LLM æä¾›å•†
crew = Crew(
    agents=[agent],
    tasks=[task],
    memory=True,
    embedder={
        "provider": "anthropic", # åŒ¹é…æ‚¨çš„ LLM æä¾›å•†
        "config": {
            "api_key": "your-anthropic-key",
            "model": "text-embedding-3-small"
        }
    }
)

# é€‰é¡¹ 2ï¼šä½¿ç”¨æœ¬åœ°åµŒå…¥ï¼ˆæ— å¤–éƒ¨ API è°ƒç”¨ï¼‰
crew = Crew(
    agents=[agent],
    tasks=[task],
    memory=True,
    embedder={
        "provider": "ollama",
        "config": {"model": "mxbai-embed-large"}
    }
)
```

### è°ƒè¯•å­˜å‚¨é—®é¢˜

#### æ£€æŸ¥å­˜å‚¨æƒé™
```python
import os
from crewai.utilities.paths import db_storage_path

storage_path = db_storage_path()
print(f"Storage path: {storage_path}")
print(f"Path exists: {os.path.exists(storage_path)}")
print(f"Is writable: {os.access(storage_path, os.W_OK) if os.path.exists(storage_path) else 'Path does not exist'}")

# åˆ›å»ºå…·æœ‰é€‚å½“æƒé™çš„å­˜å‚¨
if not os.path.exists(storage_path):
    os.makedirs(storage_path, mode=0o755, exist_ok=True)
    print(f"Created storage directory: {storage_path}")
```

#### æ£€æŸ¥ ChromaDB é›†åˆ
```python
import chromadb
from crewai.utilities.paths import db_storage_path

# è¿æ¥åˆ° CrewAI çš„ ChromaDB
storage_path = db_storage_path()
chroma_path = os.path.join(storage_path, "knowledge")

if os.path.exists(chroma_path):
    client = chromadb.PersistentClient(path=chroma_path)
    collections = client.list_collections()

    print("ChromaDB Collections:")
    for collection in collections:
        print(f"  - {collection.name}: {collection.count()} documents")
else:
    print("No ChromaDB storage found")
```

#### é‡ç½®å­˜å‚¨ï¼ˆè°ƒè¯•ï¼‰
```python
from crewai import Crew

# é‡ç½®æ‰€æœ‰è®°å¿†å­˜å‚¨
crew = Crew(agents=[...], tasks=[...], memory=True)

# é‡ç½®ç‰¹å®šè®°å¿†ç±»å‹
crew.reset_memories(command_type='short')     # çŸ­æœŸè®°å¿†
crew.reset_memories(command_type='long')      # é•¿æœŸè®°å¿†
crew.reset_memories(command_type='entity')    # å®ä½“è®°å¿†
crew.reset_memories(command_type='knowledge') # çŸ¥è¯†å­˜å‚¨
```

### ç”Ÿäº§æœ€ä½³å®è·µ

1. **è®¾ç½® `CREWAI_STORAGE_DIR`** åˆ°ç”Ÿäº§ä¸­çš„å·²çŸ¥ä½ç½®ä»¥æ›´å¥½åœ°æ§åˆ¶
2. **é€‰æ‹©æ˜¾å¼åµŒ å…¥æä¾›å•†** ä»¥åŒ¹é…æ‚¨çš„ LLM è®¾ç½®
3. **ç›‘æ§å­˜å‚¨ç›®å½•å¤§å°** ç”¨äºå¤§è§„æ¨¡éƒ¨ç½²
4. **åœ¨å¤‡ä»½ç­–ç•¥ä¸­åŒ…å«å­˜å‚¨ç›®å½•**
5. **è®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™**ï¼ˆç›®å½• 0o755ï¼Œæ–‡ä»¶ 0o644ï¼‰
6. **ä½¿ç”¨é¡¹ç›®ç›¸å¯¹è·¯å¾„** ç”¨äºå®¹å™¨åŒ–éƒ¨ç½²

## è‡ªå®šä¹‰åµŒ å…¥å™¨é…ç½®

CrewAI æ”¯æŒå¤šä¸ªåµŒ å…¥æä¾›å•†ï¼Œä½¿æ‚¨èƒ½å¤Ÿä¸ºè®°å¿†ç³»ç»Ÿé€‰æ‹©æœ€é€‚åˆæ‚¨ç”¨ä¾‹çš„é€‰é¡¹ã€‚è¿™é‡Œæ˜¯é…ç½®ä¸åŒåµŒ å…¥æä¾›å•†çš„ç»¼åˆæŒ‡å—ã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹©ä¸åŒçš„åµŒ å…¥æä¾›å•†ï¼Ÿ

- **æˆæœ¬ä¼˜åŒ–**ï¼šæœ¬åœ°åµŒå…¥ï¼ˆOllamaï¼‰åœ¨åˆå§‹è®¾ç½®åæ˜¯å…è´¹çš„
- **éšç§**ï¼šä½¿ç”¨ Ollama ä¿æŒæ•°æ®æœ¬åœ°æˆ–ä½¿ç”¨æ‚¨åå¥½çš„äº‘æä¾›å•†
- **æ€§èƒ½**ï¼šæŸäº›æ¨¡å‹åœ¨ç‰¹å®šé¢†åŸŸæˆ–è¯­è¨€ä¸Šå·¥ä½œæ›´å¥½
- **ä¸€è‡´æ€§**ï¼šä½¿æ‚¨çš„åµŒ å…¥æä¾›å•†ä¸æ‚¨çš„ LLM æä¾›å•†åŒ¹é…
- **åˆè§„æ€§**ï¼šæ»¡è¶³ç‰¹å®šçš„æ³•è§„æˆ–ç»„ç»‡è¦æ±‚

### OpenAI åµŒå…¥ï¼ˆé»˜è®¤ï¼‰

OpenAI æä¾›å¯é ã€é«˜è´¨é‡çš„åµŒå…¥ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ä½¿ç”¨åœºæ™¯ã€‚

```python
from crewai import Crew

# åŸºæœ¬ OpenAI é…ç½®ï¼ˆä½¿ç”¨ç¯å¢ƒ OPENAI_API_KEYï¼‰
crew = Crew(
    agents=[...],
    tasks=[...],
    memory=True,
    embedder={
        "provider": "openai",
        "config": {
            "model_name": "text-embedding-3-small"  # æˆ– "text-embedding-3-large"
        }
    }
)

# é«˜çº§ OpenAI é…ç½®
crew = Crew(
    memory=True,
    embedder={
        "provider": "openai",
        "config": {
            "api_key": "your-openai-api-key",  # å¯é€‰ï¼šè¦†ç›–ç¯å¢ƒå˜é‡
            "model_name": "text-embedding-3-large",
            "dimensions": 1536,  # å¯é€‰ï¼šå‡å°‘ç»´åº¦ä»¥èŠ‚çœå­˜å‚¨
            "organization_id": "your-org-id"  # å¯é€‰ï¼šç”¨äºç»„ç»‡è´¦æˆ·
        }
    }
)
```

### Azure OpenAI åµŒå…¥

å¯¹äºå…·æœ‰ Azure OpenAI éƒ¨ç½²çš„ä¼ä¸šç”¨æˆ·ã€‚

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "openai",  # Azure ä½¿ç”¨ openai æä¾›å•†
        "config": {
            "api_key": "your-azure-api-key",
            "api_base": "https://your-resource.openai.azure.com/",
            "api_type": "azure",
            "api_version": "2023-05-15",
            "model_name": "text-embedding-3-small",
            "deployment_id": "your-deployment-name"  # Azure éƒ¨ç½²åç§°
        }
    }
)
```

### Google AI åµŒå…¥

ä½¿ç”¨ Google çš„æ–‡æœ¬åµŒå…¥æ¨¡å‹ä¸ Google Cloud æœåŠ¡é›†æˆã€‚

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "google-generativeai",
        "config": {
            "api_key": "your-google-api-key",
            "model_name": "gemini-embedding-001"  # æˆ– "text-embedding-005", "text-multilingual-embedding-002"
        }
    }
)
```

### Vertex AI åµŒå…¥

å¯¹äºå…·æœ‰ Vertex AI è®¿é—®æƒé™çš„ Google Cloud ç”¨æˆ·ã€‚

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "vertexai",
        "config": {
            "project_id": "your-gcp-project-id",
            "region": "us-central1",  # æˆ–æ‚¨åå¥½çš„åŒºåŸŸ
            "api_key": "your-service-account-key",
            "model_name": "textembedding-gecko"
        }
    }
)
```

### Ollama åµŒå…¥ï¼ˆæœ¬åœ°ï¼‰

æœ¬åœ°è¿è¡ŒåµŒå…¥ä»¥ä¿æŠ¤éšç§å’ŒèŠ‚çœæˆæœ¬ã€‚

```python
# é¦–å…ˆï¼Œæœ¬åœ°å®‰è£…å’Œè¿è¡Œ Ollamaï¼Œç„¶åæ‹‰å–åµŒå…¥æ¨¡å‹ï¼š
# ollama pull mxbai-embed-large

crew = Crew(
    memory=True,
    embedder={
        "provider": "ollama",
        "config": {
            "model": "mxbai-embed-large",  # æˆ– "nomic-embed-text"
            "url": "http://localhost:11434/api/embeddings"  # é»˜è®¤ Ollama URL
        }
    }
)

# å¯¹äºè‡ªå®šä¹‰ Ollama å®‰è£…
crew = Crew(
    memory=True,
    embedder={
        "provider": "ollama",
        "config": {
            "model": "mxbai-embed-large",
            "url": "http://your-ollama-server:11434/api/embeddings"
        }
    }
)
```

## è®°å¿†äº‹ä»¶

CrewAI çš„äº‹ä»¶ç³»ç»Ÿä¸ºè®°å¿†æ“ä½œæä¾›å¼ºå¤§çš„æ´å¯Ÿã€‚é€šè¿‡åˆ©ç”¨è®°å¿†äº‹ä»¶ï¼Œæ‚¨å¯ä»¥ç›‘æ§ã€è°ƒè¯•å’Œä¼˜åŒ–è®°å¿†ç³»ç»Ÿçš„æ€§èƒ½å’Œè¡Œä¸ºã€‚

### å¯ç”¨çš„è®°å¿†äº‹ä»¶

CrewAI å‘å‡ºä»¥ä¸‹ä¸è®°å¿†ç›¸å…³çš„äº‹ä»¶ï¼š

| äº‹ä»¶ | æè¿° | å…³é”®å±æ€§ |
| :---- | :---------- | :------------- |
| **MemoryQueryStartedEvent** | è®°å¿†æŸ¥è¯¢å¼€å§‹æ—¶å‘å‡º | `query`ã€`limit`ã€`score_threshold` |
| **MemoryQueryCompletedEvent** | è®°å¿†æŸ¥è¯¢æˆåŠŸå®Œæˆæ—¶å‘å‡º | `query`ã€`results`ã€`limit`ã€`score_threshold`ã€`query_time_ms` |
| **MemoryQueryFailedEvent** | è®°å¿†æŸ¥è¯¢å¤±è´¥æ—¶å‘å‡º | `query`ã€`limit`ã€`score_threshold`ã€`error` |
| **MemorySaveStartedEvent** | è®°å¿†ä¿å­˜æ“ä½œå¼€å§‹æ—¶å‘å‡º | `value`ã€`metadata`ã€`agent_role` |
| **MemorySaveCompletedEvent** | è®°å¿†ä¿å­˜æ“ä½œæˆåŠŸå®Œæˆæ—¶å‘å‡º | `value`ã€`metadata`ã€`agent_role`ã€`save_time_ms` |
| **MemorySaveFailedEvent** | è®°å¿†ä¿å­˜æ“ä½œå¤±è´¥æ—¶å‘å‡º | `value`ã€`metadata`ã€`agent_role`ã€`error` |
| **MemoryRetrievalStartedEvent** | ä»»åŠ¡æç¤ºçš„è®°å¿†æ£€ç´¢å¼€å§‹æ—¶å‘å‡º | `task_id` |
| **MemoryRetrievalCompletedEvent** | ä»»åŠ¡æç¤ºçš„è®°å¿†æ£€ç´¢æˆåŠŸå®Œæˆæ—¶å‘å‡º | `task_id`ã€`memory_content`ã€`retrieval_time_ms` |

### å®é™…åº”ç”¨

#### 1. è®°å¿†æ€§èƒ½ç›‘æ§

è·Ÿè¸ªè®°å¿†æ“ä½œæ—¶é—´ä»¥ä¼˜åŒ–æ‚¨çš„åº”ç”¨ç¨‹åºï¼š

```python
from crewai.events import (
    BaseEventListener,
    MemoryQueryCompletedEvent,
    MemorySaveCompletedEvent
)
import time

class MemoryPerformanceMonitor(BaseEventListener):
    def __init__(self):
        super().__init__()
        self.query_times = []
        self.save_times = []

    def setup_listeners(self, crewai_event_bus):
        @crewai_event_bus.on(MemoryQueryCompletedEvent)
        def on_memory_query_completed(source, event: MemoryQueryCompletedEvent):
            self.query_times.append(event.query_time_ms)
            print(f"è®°å¿†æŸ¥è¯¢åœ¨ {event.query_time_ms:.2f}ms å†…å®Œæˆã€‚æŸ¥è¯¢ï¼š'{event.query}'")
            print(f"å¹³å‡æŸ¥è¯¢æ—¶é—´ï¼š{sum(self.query_times)/len(self.query_times):.2f}ms")

        @crewai_event_bus.on(MemorySaveCompletedEvent)
        def on_memory_save_completed(source, event: MemorySaveCompletedEvent):
            self.save_times.append(event.save_time_ms)
            print(f"è®°å¿†ä¿å­˜åœ¨ {event.save_time_ms:.2f}ms å†…å®Œæˆ")
            print(f"å¹³å‡ä¿å­˜æ—¶é—´ï¼š{sum(self.save_times)/len(self.save_times):.2f}ms")

# åˆ›å»ºç›‘å¬å™¨å®ä¾‹
memory_monitor = MemoryPerformanceMonitor()
```

#### 2. è®°å¿†å†…å®¹æ—¥å¿—è®°å½•

ä¸ºè°ƒè¯•å’Œæ´å¯Ÿè®°å½•è®°å¿†æ“ä½œï¼š

```python
from crewai.events import (
    BaseEventListener,
    MemorySaveStartedEvent,
    MemoryQueryStartedEvent,
    MemoryRetrievalCompletedEvent
)
import logging

# é…ç½®æ—¥å¿—è®°å½•
logger = logging.getLogger('memory_events')

class MemoryLogger(BaseEventListener):
    def setup_listeners(self, crewai_event_bus):
        @crewai_event_bus.on(MemorySaveStartedEvent)
        def on_memory_save_started(source, event: MemorySaveStartedEvent):
            if event.agent_role:
                logger.info(f"ä»£ç† '{event.agent_role}' æ­£åœ¨ä¿å­˜è®°å¿†ï¼š{event.value[:50]}...")
            else:
                logger.info(f"æ­£åœ¨ä¿å­˜è®°å¿†ï¼š{event.value[:50]}...")

        @crewai_event_bus.on(MemoryQueryStartedEvent)
        def on_memory_query_started(source, event: MemoryQueryStartedEvent):
            logger.info(f"è®°å¿†æŸ¥è¯¢å·²å¼€å§‹ï¼š'{event.query}'ï¼ˆé™åˆ¶ï¼š{event.limit}ï¼‰")

        @crewai_event_bus.on(MemoryRetrievalCompletedEvent)
        def on_memory_retrieval_completed(source, event: MemoryRetrievalCompletedEvent):
            if event.task_id:
                logger.info(f"ä¸ºä»»åŠ¡ {event.task_id} åœ¨ {event.retrieval_time_ms:.2f}ms å†…æ£€ç´¢è®°å¿†")
            else:
                logger.info(f"åœ¨ {event.retrieval_time_ms:.2f}ms å†…æ£€ç´¢è®°å¿†")
            logger.debug(f"è®°å¿†å†…å®¹ï¼š{event.memory_content}")

# åˆ›å»ºç›‘å¬å™¨å®ä¾‹
memory_logger = MemoryLogger()
```

## æœ€ä½³å®è·µ

- ä¿æŒé€‚å½“çš„å—å¤§å°ä»¥é€‚åº”æ‚¨çš„å†…å®¹ç±»å‹
- è€ƒè™‘å†…å®¹é‡å ä»¥ä¿æŒä¸Šä¸‹æ–‡
- å°†ç›¸å…³ä¿¡æ¯ç»„ç»‡åˆ°å•ç‹¬çš„çŸ¥è¯†æºä¸­

### æ€§èƒ½æç¤º
- æ ¹æ®å†…å®¹å¤æ‚æ€§è°ƒæ•´å—å¤§å° 
- é…ç½®é€‚å½“çš„åµŒå…¥æ¨¡å‹
- è€ƒè™‘ä½¿ç”¨æœ¬åœ°åµŒå…¥æä¾›å•†ä»¥åŠ å¿«å¤„ç†é€Ÿåº¦

### ä¸€æ¬¡æ€§çŸ¥è¯†
- ä½¿ç”¨ CrewAI æä¾›çš„å…¸å‹æ–‡ä»¶ç»“æ„ï¼ŒçŸ¥è¯†æºåœ¨æ¯æ¬¡è§¦å‘ kickoff æ—¶éƒ½ä¼šè¢«åµŒå…¥ã€‚
- å¦‚æœçŸ¥è¯†æºå¾ˆå¤§ï¼Œè¿™ä¼šå¯¼è‡´ä½æ•ˆç‡å¹¶å¢åŠ å»¶è¿Ÿï¼Œå› ä¸ºæ¯æ¬¡éƒ½ä¼šåµŒå…¥ç›¸åŒçš„æ•°æ®ã€‚
- è¦è§£å†³æ­¤é—®é¢˜ï¼Œç›´æ¥åˆå§‹åŒ–çŸ¥è¯†å‚æ•°è€Œä¸æ˜¯ knowledge_sources å‚æ•°ã€‚
- é“¾æ¥åˆ°é—®é¢˜ä»¥è·å–å®Œæ•´æ€è·¯ [Github Issue](https://github.com/crewAIInc/crewAI/issues/2755)

### çŸ¥è¯†ç®¡ç†
- ä½¿ç”¨ä»£ç†çº§åˆ«çŸ¥è¯†å¤„ç†è§’è‰²ç‰¹å®šä¿¡æ¯
- ä½¿ç”¨å›¢é˜Ÿçº§åˆ«çŸ¥è¯†å¤„ç†æ‰€æœ‰ä»£ç†éœ€è¦çš„å…±äº«ä¿¡æ¯
- å¦‚æœéœ€è¦ä¸åŒçš„åµŒå…¥ç­–ç•¥ï¼Œåœ¨ä»£ç†çº§åˆ«è®¾ç½®åµŒ å…¥å™¨
- é€šè¿‡ä¿æŒä»£ç†è§’è‰²æè¿°æ¥ä½¿ç”¨ä¸€è‡´çš„é›†åˆå‘½å
- åœ¨ kickoff åé€šè¿‡æ£€æŸ¥ agent.knowledge æ¥æµ‹è¯•çŸ¥è¯†åˆå§‹åŒ–
- é€šè¿‡æ£€æŸ¥å­˜å‚¨ä½ç½®æ¥ç›‘æ§çŸ¥è¯†å­˜å‚¨ä½ç½®
- ä½¿ç”¨æ­£ç¡®çš„å‘½ä»¤ç±»å‹é€‚å½“åœ°é‡ç½®çŸ¥è¯†

### ç”Ÿäº§æœ€ä½³å®è·µ
- åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è®¾ç½® `CREWAI_STORAGE_DIR` åˆ°å·²çŸ¥ä½ç½®
- é€‰æ‹©æ˜¾å¼åµŒå…¥æä¾›å•†ä»¥åŒ¹é…æ‚¨çš„ LLM è®¾ç½®å¹¶é¿å… API å¯†é’¥å†²çª
- ç›‘æ§éšç€æ–‡æ¡£æ·»åŠ è€Œå¢é•¿çš„çŸ¥è¯†å­˜å‚¨å¤§å°
- é€šè¿‡é›†åˆåç§°æŒ‰é¢†åŸŸæˆ–ç›®çš„ç»„ç»‡çŸ¥è¯†æº
- åœ¨æ‚¨çš„å¤‡ä»½å’Œéƒ¨ç½²ç­–ç•¥ä¸­åŒ…å«çŸ¥è¯†ç›®å½•
- ä¸ºçŸ¥è¯†æ–‡ä»¶å’Œå­˜å‚¨ç›®å½•è®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™
- ä½¿ç”¨ç¯å¢ƒå˜é‡å¤„ç† API å¯†é’¥å’Œæ•æ„Ÿé…ç½®

### æ¸…é™¤çŸ¥è¯†

å¦‚æœæ‚¨éœ€è¦æ¸…é™¤å­˜å‚¨åœ¨ CrewAI ä¸­çš„çŸ¥è¯†ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¸¦æœ‰ `--knowledge` é€‰é¡¹çš„ `crewai reset-memories` å‘½ä»¤ã€‚

```bash Command
crewai reset-memories --knowledge
```

å½“æ‚¨æ›´æ–°äº†çŸ¥è¯†æºå¹¶å¸Œæœ›ç¡®ä¿ä»£ç†ä½¿ç”¨æœ€æ–°ä¿¡æ¯æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚